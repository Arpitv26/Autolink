
üîó AutoLink
Codex CLI Config + Reference Docs
Prepared for Arpit Verma ‚Ä¢ UBC CS ‚Ä¢ February 2026
How to use: Save CODEX.md in your project root. Create an agent_docs/ folder and save the remaining files inside it. Reference these from Codex CLI sessions as needed.
Files in This Document
CODEX.md ‚Äî project root ‚Äî Codex CLI session config
agent_docs/tech_stack.md ‚Äî full stack, libraries, setup commands
agent_docs/code_patterns.md ‚Äî TypeScript rules, component/hook patterns
agent_docs/project_brief.md ‚Äî conventions, mock vs real strategy, security rules
agent_docs/product_requirements.md ‚Äî P0 features, user stories, success metrics
agent_docs/database_schema.md ‚Äî full PostgreSQL schema + RLS policies
agent_docs/ai_assistant.md ‚Äî Edge Function code, system prompt, cost controls
agent_docs/testing.md ‚Äî smoke test checklist, pre-commit hooks
Recommended Codex CLI Session Starters
Paste one of these at the start of a Codex session depending on what you&apos;re building:
&quot;Read AGENTS.md and CODEX.md. Tell me the current phase and what to build next.&quot;
&quot;Read AGENTS.md and agent_docs/tech_stack.md. Scaffold the Expo project for Phase 1.&quot;
&quot;Read agent_docs/database_schema.md. Create all Supabase tables with RLS policies.&quot;
&quot;Read agent_docs/ai_assistant.md. Build the Edge Function and useAutoLinkAI hook.&quot;
&quot;Read agent_docs/code_patterns.md. Build the infinite scroll social feed.&quot;
&quot;Read agent_docs/testing.md. Run through the smoke test checklist for the current feature.&quot;
üí° Context tip: Load only the agent_docs/ file relevant to your current task ‚Äî not all of them at once. The table at the bottom of CODEX.md shows which file maps to which task.
CODEX.md
Save as: CODEX.md (project root)
CODEX.md ‚Äî Codex CLI Configuration for AutoLink
Project Context
App: AutoLink ‚Äî AI-powered car enthusiast platform
Stack: Expo (React Native) + TypeScript | Supabase | OpenAI GPT-4o mini
Stage: MVP Development ‚Äî 12-week demo build
Developer: Arpit Verma, 2nd year CS @ UBC
---
Directives
**Read `AGENTS.md` first** ‚Äî it contains the current phase, active tasks, and blockers. Always start here.
**Load context selectively** ‚Äî only read `agent_docs/` files relevant to the current task; don&apos;t load everything at once.
**Plan before coding** ‚Äî propose a brief plan and wait for approval before making changes.
**One feature at a time** ‚Äî implement, verify, commit before moving to the next.
**Verify after every change** ‚Äî run `npm run type-check` and `npm run lint` after each file edit.
**Commit at milestones** ‚Äî create a git commit after each working feature slice.
---
Recommended Workflow (Terminal)
Start a Codex session
codex
Good opening prompts:
&quot;Read AGENTS.md and tell me what phase we&apos;re on and what to build next&quot;
&quot;Read AGENTS.md and agent_docs/tech_stack.md, then scaffold Phase 1&quot;
&quot;Read agent_docs/database_schema.md and set up the Supabase tables&quot;
Suggested Per-Feature Prompts
Phase 1 start: &quot;Read AGENTS.md and agent_docs/tech_stack.md. Scaffold the Expo project, install all dependencies, and set up the Supabase client.&quot;
Auth: &quot;Read agent_docs/tech_stack.md and implement Google OAuth using Supabase Auth.&quot;
Database: &quot;Read agent_docs/database_schema.md and create all the Supabase tables with RLS policies.&quot;
AI chat: &quot;Read agent_docs/ai_assistant.md and build the Supabase Edge Function and the useAutoLinkAI hook.&quot;
Social feed: &quot;Read agent_docs/code_patterns.md and build the infinite scroll social feed with like/comment support.&quot;
---
What NOT To Do
Do NOT use any type in TypeScript ‚Äî ever
Do NOT call OpenAI directly from React Native ‚Äî use the Supabase Edge Function
Do NOT delete files without explicit confirmation
Do NOT modify database schemas without flagging it first
Do NOT add features outside the current phase
Do NOT expose API keys in client-side code
Do NOT skip npm run lint and npm run type-check after changes
---
Commands
npx expo start                    # Dev server
npx expo start --tunnel           # If phone on different network
npm run lint                      # ESLint ‚Äî run after every change
npm run type-check                # TypeScript ‚Äî run after every change
git add -A &amp;&amp; git commit -m &quot;...&quot;  # Commit after each feature milestone
npx supabase functions deploy ai-chat   # Deploy AI Edge Function
eas build --platform ios --profile preview    # iOS build
eas build --platform android --profile preview # Android build
---
Context Loading Guide
Load these files based on what you&apos;re working on ‚Äî not all at once:
| Task | Files to load |
|------|--------------|
| Starting / orientation | `AGENTS.md` |
| Setting up the project | `AGENTS.md` + `agent_docs/tech_stack.md` |
| Database work | `agent_docs/database_schema.md` |
| Building components | `agent_docs/code_patterns.md` |
| AI chat feature | `agent_docs/ai_assistant.md` |
| Understanding requirements | `agent_docs/product_requirements.md` |
| Checking conventions | `agent_docs/project_brief.md` |
| Testing / pre-deploy | `agent_docs/testing.md` |
agent_docs/tech_stack.md
Save as: agent_docs/tech_stack.md
Tech Stack &amp; Tools ‚Äî AutoLink
Core Stack Summary
| Layer | Technology | Version | Purpose |
|-------|------------|---------|---------|
| Mobile Framework | Expo (React Native) | SDK 52+ | iOS + Android from one codebase |
| Language | TypeScript | 5.x | Type-safe JS (your Java background transfers well) |
| Backend/BaaS | Supabase | Latest | Database + Auth + Storage + Edge Functions |
| Database | PostgreSQL (via Supabase) | 15+ | Relational data for users/builds/posts |
| AI API | OpenAI GPT-4o mini | Latest | Car modification AI assistant |
| Vehicle Data | NHTSA vPIC + CarQuery | Free | Make/model/year/specs ‚Äî no key needed |
| Image Storage | Supabase Storage | Free tier | Car build photos, avatars |
| Push Notifications | Expo Push Notifications | Free | Likes, comments, follows |
| Auth | Supabase Auth (Google OAuth) | ‚Äî | Social login, no passwords |
| Navigation | Expo Router | v3+ | File-based routing like Next.js |
| Deployment | Expo EAS Build | Free tier | iOS TestFlight + Android APK |
---
Project Setup Commands
1. Install Expo CLI
npm install -g @expo/cli
2. Create AutoLink project
npx create-expo-app AutoLink --template
Select: Blank (TypeScript)
3. Install core dependencies
cd AutoLink
npx expo install expo-router expo-image expo-image-picker expo-av
npx expo install react-native-reanimated react-native-gesture-handler
npx expo install @supabase/supabase-js @react-native-async-storage/async-storage
4. Install UI/chat libraries
npm install react-native-gifted-chat openai
5. Run on phone (scan QR with Expo Go app)
npx expo start
---
Supabase Client Setup
// lib/supabase.ts
import { createClient } from &apos;@supabase/supabase-js&apos;;
import AsyncStorage from &apos;@react-native-async-storage/async-storage&apos;;
export const supabase = createClient(
  process.env.EXPO_PUBLIC_SUPABASE_URL!,
  process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY!,
  {
    auth: {
      storage: AsyncStorage,
      autoRefreshToken: true,
      persistSession: true,
      detectSessionInUrl: false,
    },
  }
);
---
Key Libraries
Navigation (Expo Router)
// app/(tabs)/index.tsx ‚Äî file-based routing
// Bottom tabs: (tabs)/ai.tsx, (tabs)/planner.tsx, (tabs)/feed.tsx, (tabs)/profile.tsx
import { Tabs } from &apos;expo-router&apos;;
export default function TabsLayout() {
  return (
    &lt;Tabs&gt;
      &lt;Tabs.Screen name=&quot;ai&quot; options={{ title: &apos;AI&apos;, tabBarIcon: ... }} /&gt;
      &lt;Tabs.Screen name=&quot;planner&quot; options={{ title: &apos;Planner&apos; }} /&gt;
      &lt;Tabs.Screen name=&quot;feed&quot; options={{ title: &apos;Feed&apos; }} /&gt;
      &lt;Tabs.Screen name=&quot;profile&quot; options={{ title: &apos;Profile&apos; }} /&gt;
    &lt;/Tabs&gt;
  );
}
Drag-and-Drop (Reanimated)
import Animated, { useSharedValue, useAnimatedStyle, withSpring } from &apos;react-native-reanimated&apos;;
import { Gesture, GestureDetector } from &apos;react-native-gesture-handler&apos;;
// Use GestureDetector + Pan gesture for draggable mod cards
AI Chat UI
import { GiftedChat, IMessage } from &apos;react-native-gifted-chat&apos;;
// Mature, production-ready chat component ‚Äî use this, don&apos;t build from scratch
Image Picker (for social posts)
import * as ImagePicker from &apos;expo-image-picker&apos;;
const result = await ImagePicker.launchImageLibraryAsync({
  mediaTypes: ImagePicker.MediaTypeOptions.Images,
  allowsMultipleSelection: true,
  quality: 0.8,
});
---
Environment Variables (.env.local)
EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
EXPO_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
DO NOT put OPENAI_API_KEY here ‚Äî use Supabase Edge Function instead
---
Folder Structure
AutoLink/
‚îú‚îÄ‚îÄ app/                    # Expo Router screens
‚îÇ   ‚îú‚îÄ‚îÄ (tabs)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai.tsx          # AI Chat screen
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ planner.tsx     # Mod Planner screen
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feed.tsx        # Social Feed screen
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile.tsx     # Profile/Garage screen
‚îÇ   ‚îú‚îÄ‚îÄ _layout.tsx         # Root layout + auth guard
‚îÇ   ‚îî‚îÄ‚îÄ onboarding.tsx      # Onboarding flow
‚îú‚îÄ‚îÄ components/             # Reusable UI components
‚îÇ   ‚îú‚îÄ‚îÄ PostCard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ModCard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ VehiclePicker.tsx
‚îÇ   ‚îî‚îÄ‚îÄ AIMessage.tsx
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts         # Supabase client
‚îÇ   ‚îú‚îÄ‚îÄ openai.ts           # AI hook (calls Edge Function, not OpenAI directly)
‚îÇ   ‚îî‚îÄ‚îÄ nhtsa.ts            # NHTSA API helpers
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ parts_catalog.json  # Mocked ~150 aftermarket parts
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îú‚îÄ‚îÄ useBuilds.ts
‚îÇ   ‚îî‚îÄ‚îÄ usePosts.ts
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îî‚îÄ‚îÄ functions/
‚îÇ       ‚îî‚îÄ‚îÄ ai-chat/        # Edge Function for OpenAI proxy
‚îî‚îÄ‚îÄ agent_docs/             # AI agent documentation (this folder)
---
Free Tier Limits (Feb 2026)
| Service | Free Limit | Risk |
|---------|-----------|------|
| Supabase DB | 500MB storage | Very safe for demo |
| Supabase Storage | 1GB | ~3,000 car photos |
| Supabase Bandwidth | 2GB/month | Fine for 100 users |
| Supabase Auth | Unlimited users | No limit |
| Supabase Edge Functions | 500K invocations/month | Well within demo range |
| Expo EAS Build | 30 builds/month | Plenty for dev cycle |
| NHTSA vPIC | Unlimited | Government API |
| CarQuery | Unlimited (attribution required) | No rate limits at demo scale |
‚ö†Ô∏è **Supabase Pause Warning:** Free tier projects pause after 1 week of inactivity.
Fix: Add a daily health-check ping (cron job or GitHub Action) to keep the project alive.
---
Error Handling Pattern
// Always wrap Supabase calls ‚Äî never assume they succeed
async function fetchBuilds(userId: string) {
  const { data, error } = await supabase
    .from(&apos;builds&apos;)
    .select(&apos;*, build_items(*)&apos;)
    .eq(&apos;user_id&apos;, userId)
    .order(&apos;created_at&apos;, { ascending: false });
  if (error) {
    console.error(&apos;fetchBuilds error:&apos;, error.message);
    // Show user-friendly error, not raw error message
    throw new Error(&apos;Could not load your builds. Please try again.&apos;);
  }
  return data;
}
---
Naming Conventions
Files: kebab-case.tsx for screens, PascalCase.tsx for components
Types: PascalCase ‚Äî type UserProfile = { ... }
Hooks: camelCase starting with use ‚Äî useAuth, useBuilds
Supabase table names: snake_case ‚Äî build_items, user_profiles
Constants: SCREAMING_SNAKE_CASE ‚Äî MAX_QUERIES_PER_DAY = 20
No any type ‚Äî use unknown with type guards, or define interfaces
agent_docs/code_patterns.md
Save as: agent_docs/code_patterns.md
Code Patterns ‚Äî AutoLink
TypeScript Rules (Non-Negotiable)
// ‚ùå FORBIDDEN ‚Äî never use any
const data: any = response.json();
// ‚úÖ CORRECT ‚Äî use unknown with type guards, or define proper types
type ApiResponse&lt;T&gt; = { data: T | null; error: string | null };
function isUserProfile(val: unknown): val is UserProfile {
  return typeof val === &apos;object&apos; &amp;&amp; val !== null &amp;&amp; &apos;username&apos; in val;
}
---
Component Pattern (Functional + Typed Props)
// components/PostCard.tsx
import { View, Text, Image, Pressable, StyleSheet } from &apos;react-native&apos;;
import { Post } from &apos;../types/database&apos;;
type PostCardProps = {
  post: Post;
  onLike: (postId: string) =&gt; void;
  isLiked: boolean;
};
export function PostCard({ post, onLike, isLiked }: PostCardProps) {
  return (
    &lt;View style={styles.card}&gt;
      &lt;Text style={styles.username}&gt;{post.profiles.username}&lt;/Text&gt;
      {post.image_urls[0] &amp;&amp; (
        &lt;Image source={{ uri: post.image_urls[0] }} style={styles.image} /&gt;
      )}
      &lt;Pressable onPress={() =&gt; onLike(post.id)} style={styles.likeButton}&gt;
        &lt;Text&gt;{isLiked ? &apos;‚ù§Ô∏è&apos; : &apos;ü§ç&apos;} {post.likes_count}&lt;/Text&gt;
      &lt;/Pressable&gt;
    &lt;/View&gt;
  );
}
const styles = StyleSheet.create({
  card: { backgroundColor: &apos;#fff&apos;, borderRadius: 12, marginBottom: 16, overflow: &apos;hidden&apos; },
  username: { fontWeight: &apos;600&apos;, padding: 12 },
  image: { width: &apos;100%&apos;, aspectRatio: 1 },
  likeButton: { padding: 12 },
});
---
Custom Hook Pattern
// hooks/usePosts.ts
import { useState, useEffect } from &apos;react&apos;;
import { supabase } from &apos;../lib/supabase&apos;;
import { Post } from &apos;../types/database&apos;;
export function usePosts() {
  const [posts, setPosts] = useState&lt;Post[]&gt;([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState&lt;string | null&gt;(null);
  useEffect(() =&gt; {
    fetchPosts();
  }, []);
  async function fetchPosts() {
    setLoading(true);
    const { data, error } = await supabase
      .from(&apos;posts&apos;)
      .select(&apos;*, profiles(username, avatar_url)&apos;)
      .order(&apos;created_at&apos;, { ascending: false })
      .limit(20);
    if (error) {
      setError(&apos;Could not load posts. Please try again.&apos;);
    } else {
      setPosts(data ?? []);
    }
    setLoading(false);
  }
  return { posts, loading, error, refresh: fetchPosts };
}
---
Optimistic UI (Likes)
// Optimistic update ‚Äî update UI immediately, sync with DB after
async function handleLike(postId: string) {
  // 1. Update UI immediately (feels instant)
  setPosts(prev =&gt;
    prev.map(p =&gt;
      p.id === postId
        ? { ...p, likes_count: p.likes_count + 1, is_liked: true }
        : p
    )
  );
  // 2. Sync with database (may fail silently at demo scale)
  const { error } = await supabase
    .from(&apos;likes&apos;)
    .insert({ post_id: postId, user_id: currentUser.id });
  // 3. Rollback if failed
  if (error) {
    setPosts(prev =&gt;
      prev.map(p =&gt;
        p.id === postId
          ? { ...p, likes_count: p.likes_count - 1, is_liked: false }
          : p
      )
    );
  }
}
---
Auth Guard Pattern
// app/_layout.tsx
import { useEffect } from &apos;react&apos;;
import { router, Stack } from &apos;expo-router&apos;;
import { supabase } from &apos;../lib/supabase&apos;;
export default function RootLayout() {
  useEffect(() =&gt; {
    supabase.auth.onAuthStateChange((event, session) =&gt; {
      if (!session) {
        router.replace(&apos;/onboarding&apos;);
      }
    });
  }, []);
  return &lt;Stack /&gt;;
}
---
Image Upload Pattern (Social Posts)
async function uploadPostImage(uri: string, userId: string): Promise&lt;string&gt; {
  const fileName = `${userId}/${Date.now()}.jpg`;
  // Convert URI to blob
  const response = await fetch(uri);
  const blob = await response.blob();
  const { data, error } = await supabase.storage
    .from(&apos;post-images&apos;)
    .upload(fileName, blob, { contentType: &apos;image/jpeg&apos;, upsert: false });
  if (error) throw new Error(&apos;Image upload failed&apos;);
  const { data: urlData } = supabase.storage
    .from(&apos;post-images&apos;)
    .getPublicUrl(data.path);
  return urlData.publicUrl;
}
---
NHTSA API Helpers
// lib/nhtsa.ts
const NHTSA_BASE = &apos;https://vpic.nhtsa.dot.gov/api/vehicles&apos;;
export async function getMakesForYear(year: number): Promise&lt;string[]&gt; {
  const res = await fetch(`${NHTSA_BASE}/getallmakes?format=json`);
  const data = await res.json();
  return data.Results.map((r: { MakeName: string }) =&gt; r.MakeName).sort();
}
export async function getModelsForMakeYear(make: string, year: number): Promise&lt;string[]&gt; {
  const res = await fetch(
    `${NHTSA_BASE}/getmodelsformakeyear/make/${encodeURIComponent(make)}/modelyear/${year}?format=json`
  );
  const data = await res.json();
  return data.Results.map((r: { Model_Name: string }) =&gt; r.Model_Name).sort();
}
export async function decodeVIN(vin: string) {
  const res = await fetch(`${NHTSA_BASE}/decodevinvalues/${vin}?format=json`);
  const data = await res.json();
  return data.Results[0]; // { Make, Model, ModelYear, Trim, EngineCylinders, ... }
}
---
Constants
// lib/constants.ts
export const MAX_AI_QUERIES_PER_DAY = 20;
export const MAX_POST_IMAGES = 5;
export const MAX_GARAGE_VEHICLES = 5;
export const AI_MAX_TOKENS = 500; // Keep costs predictable
export const PARTS_CATEGORIES = [
  &apos;Suspension&apos;, &apos;Exhaust&apos;, &apos;Intake&apos;, &apos;Wheels &amp; Tires&apos;,
  &apos;Brakes&apos;, &apos;Exterior&apos;, &apos;Interior&apos;, &apos;Engine&apos;, &apos;Lighting&apos;
] as const;
---
Pre-Commit Hooks Setup
Install husky for pre-commit hooks
npm install --save-dev husky lint-staged
Initialize husky
npx husky init
.husky/pre-commit
#!/bin/sh
npx lint-staged
package.json additions
&quot;lint-staged&quot;: {
  &quot;*.{ts,tsx}&quot;: [&quot;eslint --fix&quot;, &quot;prettier --write&quot;]
},
&quot;scripts&quot;: {
  &quot;lint&quot;: &quot;eslint . --ext .ts,.tsx&quot;,
  &quot;type-check&quot;: &quot;tsc --noEmit&quot;
}
agent_docs/project_brief.md
Save as: agent_docs/project_brief.md
Project Brief (Persistent) ‚Äî AutoLink
Product Vision
AutoLink is the only mobile app that combines AI-powered car modification advice, a visual drag-and-drop build planner, and a social community feed ‚Äî all personalised to your specific vehicle.
Tagline: Plan it. Build it. Share it.
---
Developer Context
Developer: Arpit Verma, 2nd year CS @ UBC
Background: Strong CS fundamentals (Java, C++, C, Python) ‚Äî newer to mobile/backend
Collaborator: James (design/idea side)
Timeline: 12 weeks, solo dev, ~10‚Äì15 hrs/week
Budget: ‚â§$25/month hard cap
---
Coding Conventions
TypeScript
All function parameters and return types must be explicitly typed
any is FORBIDDEN ‚Äî use unknown with type guards
Prefer type over interface for data shapes
Use Zod for runtime validation of API responses where possible
Architecture
Screens in app/(tabs)/ ‚Äî Expo Router file-based routing
Business logic in hooks/ ‚Äî custom hooks only, no logic in screens
Supabase calls only in hooks, never directly in components
OpenAI calls ONLY via Supabase Edge Function ‚Äî never from client
Styling
Use StyleSheet.create() ‚Äî no inline styles
Consistent spacing: 8pt grid (8, 16, 24, 32)
Colors: white/light backgrounds, warm accent (#FF6B35 or similar car-brand orange)
---
Quality Gates
npm run lint must pass before every commit
npm run type-check must pass before every commit
Test on Expo Go (physical device or simulator) after each feature
No console.error in production code ‚Äî handle errors with user-facing messages
---
Key Commands
Development
npx expo start              # Start dev server
npx expo start --ios        # iOS simulator
npx expo start --android    # Android emulator
Quality
npm run lint                # ESLint
npm run type-check          # TypeScript (tsc --noEmit)
Build &amp; Deploy
eas build --platform ios --profile preview    # TestFlight build
eas build --platform android --profile preview # APK build
eas submit --platform ios                      # Submit to TestFlight
Supabase
npx supabase db push        # Apply migrations
npx supabase functions deploy ai-chat         # Deploy Edge Function
---
What is Mocked vs Real (Demo Strategy)
| Feature | Approach | Reason |
|---------|----------|--------|
| Vehicle lookup (make/model/year) | REAL ‚Äî NHTSA vPIC API | Free, adds credibility |
| AI chat responses | REAL ‚Äî OpenAI GPT-4o mini | Core feature, must be live |
| User auth + profiles | REAL ‚Äî Supabase Auth | Easy, shows security awareness |
| Parts catalog | MOCKED ‚Äî static JSON (~150 parts) | Real APIs cost $1K+/year |
| Part compatibility | HYBRID ‚Äî AI reasons about it | AI can caveat uncertainty |
| Social feed posts | REAL ‚Äî Supabase DB | Core feature; seed 10‚Äì15 posts |
| Image uploads | REAL ‚Äî Supabase Storage | Required for social authenticity |
| Price comparisons | MOCKED ‚Äî hardcoded ranges | Real affiliate data post-launch |
---
Security Rules
Row Level Security (RLS) enabled on ALL Supabase tables ‚Äî no exceptions
Users can only read/write their own data (enforced by RLS, not app logic)
OpenAI API key lives ONLY in Supabase Edge Function environment variables
No passwords ever stored ‚Äî Google OAuth only for MVP
Image uploads: validate file type and size before uploading
---
Update Cadence
Update AGENTS.md &quot;Current State&quot; section after completing each phase milestone.
Update agent_docs/database_schema.md any time the schema changes.
Update this file when new conventions or constraints are established.
agent_docs/product_requirements.md
Save as: agent_docs/product_requirements.md
Product Requirements ‚Äî AutoLink
Must-Have Features (P0 ‚Äî All required for demo)
Feature 1: AI Modification Assistant
Conversational AI chat for natural language car modification questions
User Story: &quot;As a car enthusiast, I want to ask &apos;What exhaust fits my 2019 Civic?&apos; and get a confident, personalised answer so I don&apos;t waste money on incompatible parts.&quot;
Acceptance Criteria:
  - Response within 5 seconds
  - Context personalised to user&apos;s saved vehicle
  - Budget tiers provided (budget / mid / premium) where relevant
  - Flags uncertainty rather than guessing
  - Rate-limited to 20 queries/day per user (demo phase)
  - Typing indicator shown while AI responds
Tech: OpenAI GPT-4o mini via Supabase Edge Function proxy
Feature 2: Visual Modification Planner
Drag-and-drop canvas for planning car mods with cost tracking
User Story: &quot;As a car builder, I want to visually organise all my planned mods in one place ‚Äî with costs ‚Äî so I can see my full build at a glance and plan my budget.&quot;
Acceptance Criteria:
  - Add mod cards from mocked parts catalog (static JSON)
  - Mod cards are draggable into category zones
  - Filter by category, brand, price
  - Total cost displayed and updates in real time
  - Build auto-saves to Supabase
  - Share build directly to Social Feed
Tech: react-native-reanimated + Supabase PostgreSQL
Feature 3: Social Community Feed
Instagram-style feed for sharing car builds
User Story: &quot;As a car enthusiast, I want to share my build progress and see what others are building so I can get inspired and feel part of a community.&quot;
Acceptance Criteria:
  - Infinite scroll feed (public posts from all users)
  - Upload 1‚Äì5 photos per post (from camera roll)
  - Like/unlike posts (optimistic UI update)
  - Comment with threaded replies
  - Follow/unfollow other users
  - Posts can link to a specific saved Mod Planner build
Tech: Supabase PostgreSQL + Supabase Storage + expo-image-picker
Feature 4: User Auth + Garage Profile
Social login and vehicle garage that personalises the whole app
User Story: &quot;As a new user, I want to sign in quickly and tell the app what car I drive so every AI answer is relevant to my specific vehicle.&quot;
Acceptance Criteria:
  - Sign in with Google (Apple OAuth is optional for MVP)
  - Profile setup: username, display name, avatar
  - Garage: add up to 5 vehicles (year/make/model validated via NHTSA)
  - Vehicle context auto-injected into every AI query
  - Profile page shows user&apos;s builds and posts
Tech: Supabase Auth (Google OAuth) + NHTSA vPIC API
---
Should Have (P1 ‚Äî v1.1 if time allows)
Push notifications (likes, comments, follows)
VIN scanner (scan barcode to auto-populate garage)
Build cost history (track budget changes over time)
Dark mode
---
Explicitly NOT in MVP (Deferred to v2+)
Real parts catalogue API (ACES/PIES costs $1K+/year ‚Äî use mocked JSON)
Price comparison across sellers (requires affiliate API integrations)
Marketplace / in-app parts buying (payment processing, escrow, disputes)
In-app direct messaging (comments satisfy community need for now)
Native iOS/Android (Swift/Kotlin) ‚Äî Expo cross-platform only
---
Success Metrics (Demo Phase)
Primary
50+ accounts created
100+ posts made, 500+ likes
Secondary
500+ total AI queries sent
30+ saved builds created
&gt;3 minutes average session length
&gt;20% D7 retention (users return after 7 days)
---
User Personas
| Persona | Age | Profile | Primary Need |
|---------|-----|---------|-------------|
| The Beginner | 18‚Äì24 | First car, wants mods, overwhelmed | Guided AI + learn-as-you-go |
| The Planner | 22‚Äì30 | Has modded before, wants organisation | Visual build planner + cost tracking |
| The Showoff | 20‚Äì35 | Loves sharing builds on Instagram/Reddit | Social feed + build showcase |
Primary persona ‚Äî Alex:
22-year-old university student, 2019 Honda Civic Sport
Spends 3+ hours on YouTube/Reddit to verify coilover fitment; still not sure
Wants to ask, get a confident answer, add to build plan, share progress
---
UX Design Direction
Clean and minimal ‚Äî white/light backgrounds, generous whitespace
Friendly and approachable ‚Äî warm tone, encouraging copy
Car-native ‚Äî automotive design language (bold cards, rich car photography)
Confidence by default ‚Äî always show what to do next; no dead ends
Navigation Structure
Bottom tab navigation with 4 tabs:
ü§ñ AI ‚Äî AI Chat Assistant (default landing screen)
üîß Planner ‚Äî Drag-and-drop Modification Planner
üì∏ Feed ‚Äî Social Community Feed
üë§ Profile ‚Äî User profile, garage, saved builds
agent_docs/database_schema.md
Save as: agent_docs/database_schema.md
Database Schema ‚Äî AutoLink
Overview
PostgreSQL database hosted on Supabase. Row Level Security (RLS) must be enabled on all tables.
---
Full Schema SQL
-- ============================================================
-- Run this in Supabase SQL Editor to set up the full schema
-- ============================================================
-- PROFILES (extends Supabase Auth users)
create table profiles (
  id uuid references auth.users primary key,
  username text unique not null,
  display_name text,
  avatar_url text,
  created_at timestamptz default now()
);
-- VEHICLES (user&apos;s garage)
create table vehicles (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references profiles(id) on delete cascade,
  make text not null,
  model text not null,
  year int not null,
  trim text,
  is_primary boolean default false,
  created_at timestamptz default now()
);
-- BUILDS (modification plans)
create table builds (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references profiles(id) on delete cascade,
  vehicle_id uuid references vehicles(id),
  title text not null,
  description text,
  is_public boolean default true,
  total_cost numeric default 0,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);
-- BUILD_ITEMS (individual mods in a build)
create table build_items (
  id uuid primary key default gen_random_uuid(),
  build_id uuid references builds(id) on delete cascade,
  category text not null,        -- &apos;Suspension&apos;, &apos;Exhaust&apos;, etc.
  part_name text not null,
  brand text,
  price numeric,
  notes text,
  position_x float default 0,   -- for drag-and-drop canvas position
  position_y float default 0,
  status text default &apos;planned&apos;, -- &apos;planned&apos; | &apos;ordered&apos; | &apos;installed&apos;
  created_at timestamptz default now()
);
-- POSTS (social feed)
create table posts (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references profiles(id) on delete cascade,
  build_id uuid references builds(id),  -- optional link to a build
  caption text,
  image_urls text[] default &apos;{}&apos;,
  likes_count int default 0,
  comments_count int default 0,
  created_at timestamptz default now()
);
-- LIKES
create table likes (
  id uuid primary key default gen_random_uuid(),
  post_id uuid references posts(id) on delete cascade,
  user_id uuid references profiles(id) on delete cascade,
  created_at timestamptz default now(),
  unique(post_id, user_id)              -- one like per user per post
);
-- COMMENTS
create table comments (
  id uuid primary key default gen_random_uuid(),
  post_id uuid references posts(id) on delete cascade,
  user_id uuid references profiles(id) on delete cascade,
  content text not null,
  created_at timestamptz default now()
);
-- FOLLOWS
create table follows (
  id uuid primary key default gen_random_uuid(),
  follower_id uuid references profiles(id) on delete cascade,
  following_id uuid references profiles(id) on delete cascade,
  created_at timestamptz default now(),
  unique(follower_id, following_id)
);
-- AI_QUERY_LOG (for rate limiting ‚Äî 20 queries/day per user)
create table ai_query_log (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references profiles(id) on delete cascade,
  query_date date default current_date,
  query_count int default 0,
  unique(user_id, query_date)
);
---
Row Level Security (RLS) Policies
-- Enable RLS on all tables
alter table profiles enable row level security;
alter table vehicles enable row level security;
alter table builds enable row level security;
alter table build_items enable row level security;
alter table posts enable row level security;
alter table likes enable row level security;
alter table comments enable row level security;
alter table follows enable row level security;
alter table ai_query_log enable row level security;
-- PROFILES: Anyone can read, only owner can write
create policy &quot;Public profiles are viewable by everyone&quot;
  on profiles for select using (true);
create policy &quot;Users can update their own profile&quot;
  on profiles for update using (auth.uid() = id);
create policy &quot;Users can insert their own profile&quot;
  on profiles for insert with check (auth.uid() = id);
-- VEHICLES: Owner only
create policy &quot;Users can manage their own vehicles&quot;
  on vehicles for all using (auth.uid() = user_id);
-- BUILDS: Public builds viewable by all, owner can manage
create policy &quot;Public builds are viewable&quot;
  on builds for select using (is_public = true or auth.uid() = user_id);
create policy &quot;Users can manage their own builds&quot;
  on builds for insert with check (auth.uid() = user_id);
create policy &quot;Users can update their own builds&quot;
  on builds for update using (auth.uid() = user_id);
create policy &quot;Users can delete their own builds&quot;
  on builds for delete using (auth.uid() = user_id);
-- POSTS: Public viewable, owner can insert/delete
create policy &quot;Posts are publicly viewable&quot;
  on posts for select using (true);
create policy &quot;Users can create posts&quot;
  on posts for insert with check (auth.uid() = user_id);
create policy &quot;Users can delete their own posts&quot;
  on posts for delete using (auth.uid() = user_id);
-- LIKES: Anyone can read, authenticated users can like
create policy &quot;Likes are publicly viewable&quot;
  on likes for select using (true);
create policy &quot;Authenticated users can like&quot;
  on likes for insert with check (auth.uid() = user_id);
create policy &quot;Users can unlike&quot;
  on likes for delete using (auth.uid() = user_id);
-- COMMENTS: Public read, authenticated write
create policy &quot;Comments are publicly viewable&quot;
  on comments for select using (true);
create policy &quot;Authenticated users can comment&quot;
  on comments for insert with check (auth.uid() = user_id);
create policy &quot;Users can delete their own comments&quot;
  on comments for delete using (auth.uid() = user_id);
---
Key TypeScript Types
// types/database.ts ‚Äî generate these from Supabase CLI or write manually
export type Profile = {
  id: string;
  username: string;
  display_name: string | null;
  avatar_url: string | null;
  created_at: string;
};
export type Vehicle = {
  id: string;
  user_id: string;
  make: string;
  model: string;
  year: number;
  trim: string | null;
  is_primary: boolean;
};
export type Build = {
  id: string;
  user_id: string;
  vehicle_id: string | null;
  title: string;
  description: string | null;
  is_public: boolean;
  total_cost: number;
  build_items?: BuildItem[];
  created_at: string;
};
export type BuildItem = {
  id: string;
  build_id: string;
  category: string;
  part_name: string;
  brand: string | null;
  price: number | null;
  notes: string | null;
  position_x: number;
  position_y: number;
  status: &apos;planned&apos; | &apos;ordered&apos; | &apos;installed&apos;;
};
export type Post = {
  id: string;
  user_id: string;
  build_id: string | null;
  caption: string | null;
  image_urls: string[];
  likes_count: number;
  comments_count: number;
  created_at: string;
  profiles: Pick&lt;Profile, &apos;username&apos; | &apos;avatar_url&apos;&gt;; // joined
};
---
Tip: Auto-generate Types from Supabase
After schema is set up, generate TypeScript types automatically
npx supabase gen types typescript --project-id YOUR_PROJECT_ID &gt; types/supabase.ts
agent_docs/ai_assistant.md
Save as: agent_docs/ai_assistant.md
AI Assistant Implementation ‚Äî AutoLink
Architecture: Always Via Edge Function
Mobile App ‚Üí Supabase Edge Function ‚Üí OpenAI GPT-4o mini
                     ‚Üë
              (API key lives here only)
              (rate limiting enforced here)
              (token capping enforced here)
Never call OpenAI directly from React Native ‚Äî always proxy through Supabase Edge Function.
---
Supabase Edge Function (ai-chat)
// supabase/functions/ai-chat/index.ts
import OpenAI from &apos;npm:openai@^4.0.0&apos;;
import { createClient } from &apos;npm:@supabase/supabase-js@^2.0.0&apos;;
const openai = new OpenAI({ apiKey: Deno.env.get(&apos;OPENAI_API_KEY&apos;) });
const SYSTEM_PROMPT = `You are AutoLink AI, an expert automotive modification assistant.
You help car enthusiasts plan modifications, check part compatibility,
and get personalized recommendations for their specific vehicle.
Your Knowledge Areas:
Performance modifications: engines, turbos, exhaust, intake, suspension, brakes
Appearance mods: wheels, body kits, lighting, wraps, tints
Part compatibility: year/make/model/trim fitment verification
Budget planning: cost estimates, parts sourcing recommendations
DIY vs. professional install guidance (skill level estimates)
Safety considerations and legal compliance notes
User&apos;s Current Vehicle: {vehicleContext}
Behavior Rules:
Always ask for vehicle year/make/model/trim if not provided
When checking compatibility, explicitly confirm fitment or flag uncertainty
Provide 3 price tiers when possible: budget / mid-range / premium
Recommend reputable brands (KW, Bilstein, Borla, K&amp;N, Mishimoto, etc.)
Flag mods that may void warranty or fail emissions tests
Be encouraging and enthusiastic ‚Äî you love cars
If asked non-automotive questions, politely redirect
Keep responses concise unless user asks for detail
Respond in a conversational, knowledgeable tone. Use bullet points for part lists.`;
const MAX_QUERIES_PER_DAY = 20;
Deno.serve(async (req) =&gt; {
  const { messages, vehicleContext, userId } = await req.json();
  // 1. Initialize Supabase client
  const supabase = createClient(
    Deno.env.get(&apos;SUPABASE_URL&apos;)!,
    Deno.env.get(&apos;SUPABASE_SERVICE_ROLE_KEY&apos;)!
  );
  // 2. Rate limit check (20 queries/day per user)
  const today = new Date().toISOString().split(&apos;T&apos;)[0];
  const { data: queryLog } = await supabase
    .from(&apos;ai_query_log&apos;)
    .select(&apos;query_count&apos;)
    .eq(&apos;user_id&apos;, userId)
    .eq(&apos;query_date&apos;, today)
    .single();
  const currentCount = queryLog?.query_count ?? 0;
  if (currentCount &gt;= MAX_QUERIES_PER_DAY) {
    return new Response(
      JSON.stringify({ error: &apos;Daily query limit reached. Come back tomorrow!&apos; }),
      { status: 429 }
    );
  }
  // 3. Call OpenAI
  const response = await openai.chat.completions.create({
    model: &apos;gpt-4o-mini&apos;,
    messages: [
      {
        role: &apos;system&apos;,
        content: SYSTEM_PROMPT.replace(&apos;{vehicleContext}&apos;, vehicleContext ?? &apos;No vehicle selected&apos;)
      },
      ...messages
    ],
    max_tokens: 500,       // Cap to control costs
    temperature: 0.7,
  });
  // 4. Increment query count
  await supabase.from(&apos;ai_query_log&apos;).upsert({
    user_id: userId,
    query_date: today,
    query_count: currentCount + 1,
  });
  return new Response(
    JSON.stringify({ reply: response.choices[0].message.content }),
    { headers: { &apos;Content-Type&apos;: &apos;application/json&apos; } }
  );
});
---
React Native AI Hook
// hooks/useAutoLinkAI.ts
import { useState } from &apos;react&apos;;
import { supabase } from &apos;../lib/supabase&apos;;
import { useAuth } from &apos;./useAuth&apos;;
type Message = {
  role: &apos;user&apos; | &apos;assistant&apos;;
  content: string;
};
export function useAutoLinkAI(vehicleContext: string) {
  const [messages, setMessages] = useState&lt;Message[]&gt;([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState&lt;string | null&gt;(null);
  const { user } = useAuth();
  async function sendMessage(userText: string) {
    const newMessages: Message[] = [...messages, { role: &apos;user&apos;, content: userText }];
    setMessages(newMessages);
    setLoading(true);
    setError(null);
    try {
      const { data, error: fnError } = await supabase.functions.invoke(&apos;ai-chat&apos;, {
        body: {
          messages: newMessages,
          vehicleContext,
          userId: user?.id,
        },
      });
      if (fnError) throw fnError;
      const reply = data.reply as string;
      setMessages(prev =&gt; [...prev, { role: &apos;assistant&apos;, content: reply }]);
      return reply;
    } catch (err) {
      const msg = err instanceof Error ? err.message : &apos;AI is unavailable. Please try again.&apos;;
      setError(msg);
    } finally {
      setLoading(false);
    }
  }
  function clearHistory() {
    setMessages([]);
  }
  return { messages, loading, error, sendMessage, clearHistory };
}
---
Cost Estimation (Demo Scale)
Assumptions: 100 users, 10 queries/day each, avg 300 input + 400 output tokens per query.
| Metric | Calculation | Result |
|--------|-------------|--------|
| Daily queries | 100 √ó 10 | 1,000/day |
| Daily input tokens | 1,000 √ó 300 | 300K tokens |
| Daily output tokens | 1,000 √ó 400 | 400K tokens |
| Monthly input tokens | 300K √ó 30 | 9M tokens |
| Monthly output tokens | 400K √ó 30 | 12M tokens |
| Input cost (GPT-4o mini) | 9M √ó $0.15/M | $1.35 |
| Output cost (GPT-4o mini) | 12M √ó $0.60/M | $7.20 |
| **Total AI cost** | | **~$8.55/month** |
| With system prompt caching | ~50% off input | **~$5‚Äì6/month** |
Budget status: Well within $25/month cap.
---
Cost Controls
**max_tokens: 500** on every call ‚Äî prevents runaway long responses
**20 queries/day** per user limit ‚Äî enforced in Edge Function
**System prompt caching** ‚Äî OpenAI caches repeated system prompts automatically after ~1,024 tokens; keep your system prompt stable
**Pre-generate common answers** ‚Äî for the 20 most-asked questions (e.g. &quot;best coilovers for 2019 Civic&quot;), cache in Supabase and return instantly without API call
agent_docs/testing.md
Save as: agent_docs/testing.md
Testing Strategy ‚Äî AutoLink
Philosophy
This is a demo-phase app. The goal is &quot;it works reliably for a recruiter demo,&quot; not production-grade test coverage. Focus on manual smoke tests + TypeScript type safety to catch most bugs.
---
Testing Layers
Layer 1: TypeScript (Primary Safety Net)
Run after every change:
npm run type-check   # tsc --noEmit ‚Äî catches type errors without building
This catches ~70% of bugs for a TypeScript app before you even open the simulator.
Layer 2: ESLint (Code Quality)
npm run lint         # eslint . --ext .ts,.tsx
Configured to catch: unused imports, missing dependencies in useEffect, potential null refs.
Layer 3: Manual Smoke Tests (After Each Feature)
After implementing each feature, test these flows on Expo Go (physical device or simulator):
Auth flow:
‚òê Tap &quot;Sign in with Google&quot; ‚Üí Google OAuth opens ‚Üí redirects back ‚Üí profile screen appears
‚òê Sign out ‚Üí landing screen appears
‚òê Sign back in ‚Üí session restored automatically
Garage flow:
‚òê Add vehicle ‚Üí year picker ‚Üí make dropdown (from NHTSA) ‚Üí model dropdown ‚Üí save
‚òê Vehicle appears on profile page
‚òê Vehicle context appears in AI chat header
AI Chat flow:
‚òê Type &quot;What coilovers fit my [vehicle]?&quot; ‚Üí response within 5 seconds
‚òê Response includes budget tiers
‚òê Typing indicator appears while waiting
‚òê Send 21 messages in one day ‚Üí 21st gets rate limit error message
Mod Planner flow:
‚òê Browse parts catalog ‚Üí filter by category
‚òê Drag a part card ‚Üí drops into zone ‚Üí cost updates
‚òê Build auto-saves to Supabase (verify in Supabase dashboard)
‚òê Tap &quot;Share to Feed&quot; ‚Üí post appears in feed
Social Feed flow:
‚òê Feed loads with posts visible
‚òê Tap heart ‚Üí like count increments immediately (optimistic update)
‚òê Tap heart again ‚Üí unlike
‚òê Tap comment icon ‚Üí type comment ‚Üí submit ‚Üí appears in thread
‚òê Upload photo ‚Üí post appears in feed with image
Image upload:
‚òê Select image from camera roll ‚Üí upload to Supabase Storage ‚Üí public URL returned
‚òê Image renders in post card
---
Pre-Commit Hooks
Setup (one-time)
npm install --save-dev husky lint-staged
npx husky init
.husky/pre-commit content:
#!/bin/sh
npx lint-staged
package.json:
&quot;lint-staged&quot;: {
  &quot;*.{ts,tsx}&quot;: [
    &quot;eslint --fix&quot;,
    &quot;prettier --write&quot;
  ]
}
The pre-commit hook runs automatically before every git commit. Do not bypass it (--no-verify) unless there&apos;s a documented emergency.
---
Supabase Verification
After database operations, verify in Supabase Dashboard:
Table Editor ‚Üí check rows were created/updated correctly
Authentication ‚Üí verify user accounts are created
Storage ‚Üí verify images uploaded to correct bucket
Logs ‚Üí check Edge Function logs for AI call errors
Or use Supabase CLI
npx supabase db inspect     # Check schema
npx supabase logs           # View function logs
---
Common Issues &amp; Fixes
| Issue | Likely Cause | Fix |
|-------|-------------|-----|
| Supabase project paused | Free tier inactivity | Add GitHub Action to ping project daily |
| AI returning generic answers | Missing vehicle context | Check vehicleContext is passed to Edge Function |
| Image upload failing | Bucket RLS policy | Check storage bucket policies in Supabase dashboard |
| Drag-and-drop janky | Missing gesture handler setup | Ensure GestureHandlerRootView wraps app root |
| Auth not persisting | AsyncStorage not configured | Check supabase client `storage: AsyncStorage` setting |
| &quot;Network request failed&quot; | Dev server and phone not on same WiFi | Use `--tunnel` flag: `npx expo start --tunnel` |
---
Before Demo Day Checklist
‚òê All 4 P0 features work end-to-end on a physical device
‚òê App loads in &lt; 2 seconds on a mid-range Android
‚òê AI responses consistently arrive in &lt; 5 seconds
‚òê Feed is seeded with 10‚Äì15 realistic-looking posts
‚òê At least 5 beta testers (friends/classmates) have used the app
‚òê No console.error messages during normal usage
‚òê App icon and splash screen are set
‚òê Onboarding flow is complete (3 screens)
‚òê Deployed to TestFlight or shareable APK link ready
‚òê Screen recording of the full demo flow ready as backup
AutoLink ‚Ä¢ Codex CLI Config + Docs ‚Ä¢ February 2026 ‚Ä¢ Arpit Verma @ UBC
